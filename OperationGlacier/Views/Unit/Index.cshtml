@{
    ViewBag.Title = "UNIT_NAME";
}
@Scripts.Render("~/Scripts/handlebars-v3.0.1.js")
@Styles.Render("~/Content/jquery.dynatable.css")
@Scripts.Render("~/Scripts/jquery.dynatable.js")
@RenderPage("../Includes/HandlebarsTemplates.cshtml")
<div class="row" id="unit-timeline">

</div>
<script>
    function render_unit_data_panel(i, unit) {
        var html = "";
        if (i != -1) {
            html += "<div class='col-sm-6'>";
        } else {
            html += "<div class='col-sm-6'>";
        }
        html += "<div class='panel panel-default'><div class='panel-body'>";
        
        if (unit.owner == 0) {
            unit.owner = "Japan";
        }
        if (unit.owner == 1) {
            unit.owner = "Allies";
        }
        if (unit.type_str == "AirGroup") {
            html += airgroup_template(unit);
        } else if (unit.type_str == "Base") {
            unit.row.Supply = commaSeparateNumber(unit.row.Supply);
            unit.row.Fuel = commaSeparateNumber(unit.row.Fuel);
            html += base_template(unit);
        } else if (unit.type_str == "TaskForce") {
            html += taskforce_template(unit);
            html += "<div style='margin-left:20px'>";
            $.each(unit.subunits, function (i, subunit) {
                html += ship_template(subunit);
                html += "<div style='margin-left:20px'>";
                $.each(subunit.subunits, function (i, subsubunit) {
                    html += airgroup_template(subsubunit);
                });
                html += "</div>";
            });
            html += "</div>";
        } else if (unit.type_str == "Ship") {
            html += ship_template(unit);
            html += "<div style='margin-left:20px'>";
            $.each(unit.subunits, function (i, subunit) {
                html += airgroup_template(subunit);
            });
            html += "</div>";
        } else if (unit.type_str == "LCU") {
            html += lcu_template(unit);
        }
        html += "</div>";
        html += "</div>";
        html += "</div>";
        return html;
    }
    function render_comments(timeline) {
        var html = "";

        html += "<div class='col-sm-6'>";

        html += "<div class='panel panel-default'>";
        html += "<div class='panel-heading'><h2>Comments</h2></div>";
        html += "<div class='panel-body'>";
        html += "<a href='/OperationGlacier/Comments/Create'>Add Comment</a>";

        html += "</div>";
        html += "</div>";
        html += "</div>";
        return html;
    }
    function render_graphs(timeline) {
        return "";
    }
    function display_timeline(timeline) {
        document.title = document.title.replace("UNIT_NAME", timeline.name);
        var all_html = "";
        var first = true;
        timeline.unit_data.reverse();//scroll down = go backwards in time
        all_html += render_unit_data_panel(-1, timeline.unit_data.shift());
        //PUT GRAPHS IN HERE, SUPPLY ETC!
        //comments too!
        all_html += render_comments(timeline);
        all_html += render_graphs(timeline);
        $.each(timeline.unit_data, function (i, unit) { all_html += render_unit_data_panel(i, unit); });

        document.querySelector('#unit-timeline').innerHTML = all_html;
    }
    //download the json
    (function () {
        var link = "/OperationGlacier/GameData/Timeline/" + "@Ajax.JavaScriptStringEncode(ViewBag.tid)" + ".json";
        $.getJSON(link).done(display_timeline);


    }).call(this);

</script>
