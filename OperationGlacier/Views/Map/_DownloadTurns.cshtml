<script>
    function final(){

        var baseMaps = {
            "WitP-AE Topo Map Project": topo,
            "Yamato Damashii" : yamato
        };

        var overlayMaps = {
            "Insignificant 'Dot' Bases": L.layerGroup(group_dot_bases)
        };
        L.control.layers(baseMaps, overlayMaps).addTo(map);
    }
    (function () {
        var side = '@Ajax.JavaScriptStringEncode(Model.side)';
        var date = '@Ajax.JavaScriptStringEncode(Model.date_str)';
        var speed_fac = 3.0 / 16.0;
        var initial = 2000;
        if (side == "Both") {
            var link1 = '/OperationGlacierGameData/Turns/' + 'Allies' + '/' + date + '/Turn';
            setTimeout(function () { $.getJSON(link1 + '0.json').done(load_hexes); }, 0000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '1.json').done(load_hexes); }, 1000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '2.json').done(load_hexes); }, 2000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '3.json').done(load_hexes); }, 3000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '4.json').done(load_hexes); }, 4000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '5.json').done(load_hexes); }, 5000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '6.json').done(load_hexes); }, 6000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '7.json').done(load_hexes); }, 7000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '8.json').done(load_hexes); }, 8000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '9.json').done(load_hexes); }, 9000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '10.json').done(load_hexes); }, 10000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '11.json').done(load_hexes); }, 11000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '12.json').done(load_hexes); }, 12000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '13.json').done(load_hexes); }, 13000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '14.json').done(load_hexes); }, 14000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link1 + '15.json').done(load_hexes).done(final); }, 15000 * speed_fac + initial);

            var link2 = '/OperationGlacierGameData/Turns/' + 'Japan' + '/' + date + '/Turn';
            setTimeout(function () { $.getJSON(link2 + '0.json').done(load_hexes); }, 0000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '1.json').done(load_hexes); }, 1000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '2.json').done(load_hexes); }, 2000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '3.json').done(load_hexes); }, 3000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '4.json').done(load_hexes); }, 4000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '5.json').done(load_hexes); }, 5000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '6.json').done(load_hexes); }, 6000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '7.json').done(load_hexes); }, 7000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '8.json').done(load_hexes); }, 8000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '9.json').done(load_hexes); }, 9000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '10.json').done(load_hexes); }, 10000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '11.json').done(load_hexes); }, 11000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '12.json').done(load_hexes); }, 12000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '13.json').done(load_hexes); }, 13000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '14.json').done(load_hexes); }, 14000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link2 + '15.json').done(load_hexes).done(final); }, 15000 * speed_fac + initial);
        } else {
            var link = '/OperationGlacierGameData/Turns/' + side + '/' + date + '/Turn';
            setTimeout(function () { $.getJSON(link + '0.json').done(load_hexes); }, 0000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '1.json').done(load_hexes); }, 1000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '2.json').done(load_hexes); }, 2000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '3.json').done(load_hexes); }, 3000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '4.json').done(load_hexes); }, 4000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '5.json').done(load_hexes); }, 5000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '6.json').done(load_hexes); }, 6000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '7.json').done(load_hexes); }, 7000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '8.json').done(load_hexes); }, 8000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '9.json').done(load_hexes); }, 9000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '10.json').done(load_hexes); }, 10000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '11.json').done(load_hexes); }, 11000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '12.json').done(load_hexes); }, 12000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '13.json').done(load_hexes); }, 13000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '14.json').done(load_hexes); }, 14000 * speed_fac + initial);
            setTimeout(function () { $.getJSON(link + '15.json').done(load_hexes).done(final); }, 15000 * speed_fac + initial);
        }
        
    }).call(this);
</script>
